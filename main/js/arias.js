// ================= 文本数据配置区域 =================
const articlesData = [
    {
        id: 1,
        title: "遗物商行",
        author: "匿名投稿",
        date: "2025-01-01",
        excerpt: "在旧城的深巷中，有一盏永不熄灭的昏黄油灯。油灯下是一扇古旧的木门，上面挂着一块铜牌，字迹已经斑驳——“遗物商行”。",
        content: `
            <p>在旧城的深巷中，有一盏永不熄灭的昏黄油灯。油灯下是一扇古旧的木门，上面挂着一块铜牌，字迹已经斑驳，却还能辨认出四个字——“遗物商行”。</p>
            <p>推开木门，风铃轻响。空气中混杂着尘土与草药的气味，仿佛时间在此处凝固。屋内光线昏暗，陈列架上摆放着各式古怪的物件：逆流的沙漏、指针永远停在十二点的怀表、泛黄的契约书。柜台后，一名戴着青铜面具的男人静静坐着。他就是人们口中的遗物商人。</p>
            <p>这一夜，走进店里的是一名年轻画家。他穿着沾满颜料的外套，眼神疲惫却炽热。他低声说道：“我需要……灵感。”</p>
            <p>商人抬起头，声音低沉：“每位客人都会得到属于自己的遗物。但要记住，它们不会满足愿望，只会展示真实。”</p>
            <p>他从抽屉里取出一个小木盒，轻轻推到画家面前。盒盖开启，里面静静躺着一串项链。玻璃珠间夹杂着干枯的眼球，每一颗眼珠都隐隐闪烁着微光，仿佛在注视来人。</p>
            <p>画家呼吸急促，指尖触碰项链时，竟感受到一股清凉温和的触感，如同溪水拂过。</p>
            <p>“它会让我画得更好吗？”画家喃喃。</p>
            <p>“它会让你看见灵魂的颜色。”商人平静地答道。</p>
            <p>——</p>
            <p>画家将项链挂在颈间。</p>
            <p>从那天起，他的世界骤然不同。街道上的人们，在他眼中不再是普通的躯体，而是被光芒与色彩包围：有人燃烧着赤红的火焰，仿佛随时要自毁；有人笼罩在淡蓝的微光里，温和而宁静；也有人只有灰白的色调，仿佛失去了存在的意义。</p>
            <p>他开始在画布上重现这些色彩。笔触比以往更加坚定，画面散发出奇异的力量。观者在他的作品前久久驻足，仿佛透过颜料看见了灵魂深处最隐秘的情感。</p>
            <p>消息迅速传开，人们蜂拥而至，争相观赏。他的画价节节攀升，许多人称他为“能描绘灵魂的画师”。</p>
            <p>然而，画家自己却日渐沉默。他常常在画布前发呆，眼神空洞，好像在倾听某种无声的低语。朋友问他是否安好，他只是摇头，继续作画。</p>
            <p>——</p>
            <p>一个月后，他在王都举办画展。展厅灯火通明，四壁挂满了作品。每幅画都闪耀着奇异的光彩：有的让观者心头涌起幸福的暖流，有的让人泪流不止，有的甚至令胆小者崩溃倒地。</p>
            <p>大厅中央摆放着一幅尚未完成的巨作。那是一片辽阔夜空，数以百计的灵魂之色交织在一起，如同真正的星河在画布上缓缓流动。</p>
            <p>当众人屏息凝视时，画家却缓缓开口：“其实，我已经看不见了。”</p>
            <p>会场一片哗然。有人仔细看去，才发现他的双眼早已失去了光泽，蒙上一层乳白。他却神情安宁，没有痛苦，仿佛这正是他所追寻的结局。</p>
            <p>“我已画尽所见，”画家说，“如今，这些颜色已经留在画里，不再属于我。”</p>
            <p>他摘下项链，将其轻轻放在画架前。项链的眼球在灯光下闪了一瞬，随后暗淡下来。</p>
            <p>——</p>
            <p>画展结束，画家悄然离开了王都。他的下落再无人知晓。有人说他回到了乡间，静养余生；也有人说，他追随着某种灵感，走向了荒原。</p>
            <p>但在展览后的很长一段时间里，许多观众声称，夜晚再看那幅“星河”画作时，会觉得画中的色彩在流动，甚至能听见陌生的低语。有人因此陷入疯狂，也有人因此声名鹊起。作品与观者之间，似乎也形成了一种诡秘的羁绊。</p>
            <p>而画家本人，从未再现身。</p>
            <p>——</p>
            <p>数日后，那串眼球项链又静静地躺在遗物商行的柜子里。它微微闪光，仿佛从未离开过。</p>
            <p>商人抬眼凝视，低声自语：“并非所有遗物都会带来诅咒，有些只是提醒人类，代价早已存在。”</p>
            <p>他伸手轻轻拨动项链，眼珠们仿佛瞬间睁开了一下，旋即闭合。那光景快得像是错觉，却让人脊背发凉。</p>
            <p>油灯摇曳，风铃轻响。门口的铃铛再次作响，又一位新客人踏入门槛。</p>
            <p>故事，还会继续。</p>
        `
    },
    {
        id: 2,
        title: "示例文章二",
        author: "编辑部",
        date: "2025-01-02",
        excerpt: "这是另一个故事的占位符，用于展示网格布局的效果...",
        content: "<p>这里是正文内容...</p>"
    }
];
// ===========================================

const textGrid = document.getElementById('textGrid');
const readerModal = document.getElementById('readerModal');
const closeReaderBtn = document.querySelector('.close-reader');
const themeBtn = document.getElementById('themeToggle');

// 阅读器元素
const readerTitle = document.getElementById('reader-title');
const readerAuthor = document.getElementById('reader-author');
const readerDate = document.getElementById('reader-date');
const readerBody = document.getElementById('reader-body');

// 初始化
function init() {
    renderGrid();
    initTheme(); // 初始化主题
}

// ------------------------------------
// 1. 日夜模式逻辑
// ------------------------------------
function initTheme() {
    // 检查本地存储
    const savedTheme = localStorage.getItem('theme');
    const icon = themeBtn.querySelector('i');
    
    if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
        icon.classList.replace('fa-moon', 'fa-sun'); // 换成太阳图标
    }

    // 绑定点击事件
    themeBtn.onclick = () => {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        
        // 切换图标
        if (isDark) {
            icon.classList.replace('fa-moon', 'fa-sun');
            localStorage.setItem('theme', 'dark');
        } else {
            icon.classList.replace('fa-sun', 'fa-moon');
            localStorage.setItem('theme', 'light');
        }
    };
}

// ------------------------------------
// 2. 渲染卡片网格
// ------------------------------------
function renderGrid() {
    textGrid.innerHTML = '';
    
    articlesData.forEach(article => {
        const card = document.createElement('div');
        card.className = 'text-card';
        card.onclick = () => openReader(article.id);
        
        card.innerHTML = `
            <div class="card-icon"><i class="fas fa-book-open"></i></div>
            <div class="card-title">${article.title}</div>
            <div class="card-excerpt">${article.excerpt}</div>
            <div class="card-footer">
                <span><i class="far fa-user"></i> ${article.author}</span>
                <span class="read-btn">阅读全文 <i class="fas fa-arrow-right"></i></span>
            </div>
        `;
        
        textGrid.appendChild(card);
    });
}

// ------------------------------------
// 3. 阅读器操作
// ------------------------------------
window.openReader = function(id) {
    const article = articlesData.find(a => a.id === id);
    if (!article) return;

    // 填充内容
    readerTitle.textContent = article.title;
    readerAuthor.innerHTML = `<i class="fas fa-user"></i> ${article.author}`;
    readerDate.innerHTML = `<i class="far fa-clock"></i> ${article.date}`;
    readerBody.innerHTML = article.content;

    // 显示弹窗 (添加 .show 类触发 CSS 过渡)
    readerModal.classList.add('show');
    document.body.style.overflow = 'hidden'; // 禁止背景滚动
};

// 关闭阅读器
function closeReader() {
    readerModal.classList.remove('show');
    document.body.style.overflow = ''; // 恢复滚动
}

// 绑定关闭事件
closeReaderBtn.onclick = closeReader;

// 点击遮罩层关闭
readerModal.onclick = (e) => {
    if (e.target === readerModal) {
        closeReader();
    }
};

// ESC 键关闭
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && readerModal.classList.contains('show')) {
        closeReader();
    }
});

// 启动
init();